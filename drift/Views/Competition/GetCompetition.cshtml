@using Microsoft.AspNetCore.Http
@model drift.Models.Dto.CompetitionDto
@inject IHttpContextAccessor httpContextAccessor


@{
	ViewBag.Title = "title";
	Layout = "_Layout";
}

<h2>@Model.Name</h2>
<p>@Model.Description</p>
<p>@Model.StartDate</p>

@if (@Model.CreatedById.Equals(httpContextAccessor.HttpContext.User.Identity.Name))
{
<table class="table">
	<thead>
		<tr>
			<th>
				@Html.DisplayNameFor(model => @Model.Applications.First().ParticipantName)
			</th>
			<th>
				@Html.DisplayNameFor(model => @Model.Applications.First().ParticipantNumber)
			</th>
			<th>
				@Html.DisplayNameFor(model => @Model.Applications.First().Paid)
			</th>
			<th>
				@Html.DisplayNameFor(model => @Model.Applications.First().ApprovedByTech)
			</th>
			<th>
				@Html.DisplayNameFor(model => @Model.Applications.First().ApprovedByMedics)
			</th>
			<th>
				@Html.DisplayNameFor(model => @Model.Applications.First().ApprovedByOrganizer)
			</th>
			<th>Действие</th>
		</tr>
	</thead>
	@foreach (var application in @Model.Applications)
	{

		<tbody>
			<tr>
				<td>
					@Html.DisplayFor(modelItem => application.ParticipantName)
				</td>
				<td>
					@Html.DisplayFor(modelItem => application.ParticipantNumber)
				</td>
				<td>
					@Html.DisplayFor(modelItem => application.Paid)
				</td>
				<td>
					@Html.DisplayFor(modelItem => application.ApprovedByTech)
				</td>
				<td>
					@Html.DisplayFor(modelItem => application.ApprovedByMedics)
				</td>
				<td>
					@Html.DisplayFor(modelItem => application.ApprovedByOrganizer)
				</td>
				<td>
					@if (!application.ApprovedByOrganizer)
					{
						<button>
							<a asp-action="Approve" asp-route-id="@application.ApplicationId">Подтвердить участие</a>
						</button>
					}
				</td>
			</tr>
		</tbody>
	}
</table>
	@if ((bool)!@Model.Finished)
	{
		@Html.ActionLink("Start competition", "GenerateResults", "CompetitionResult", new { competitionId = @Model.Id }, new { @class = "mb-1" })
	}
	else
	{
		@Html.ActionLink("Сетка результатов", "GetResults", "CompetitionResult", new { competitionId = @Model.Id }, new { @class = "mb-1" })
		<br>
		@Html.ActionLink("Очки", "GetScores", "CompetitionResult", new { competitionId = @Model.Id }, new { @class = "mb-1" })

	}
}